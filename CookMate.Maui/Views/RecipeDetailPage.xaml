<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:CookMate.Maui.ViewModels"
             x:Class="CookMate.Maui.Views.RecipeDetailPage"
             x:DataType="viewmodels:RecipeDetailViewModel"
             Title="{Binding Recipe.Title}"
             BackgroundColor="{StaticResource Gray50}">

    <!-- 
    Recipe Detail page matching the original React RecipeDetail component.
    Features:
    - Full recipe image
    - Meta info (time, servings, difficulty)
    - Ingredients list
    - Step-by-step instructions
    - Favorite toggle
    -->

    <ScrollView>
        <VerticalStackLayout Padding="24" Spacing="24">
            
            <!-- Back Button -->
            <Button Text="â† ZurÃ¼ck"
                    BackgroundColor="Transparent"
                    TextColor="{StaticResource Gray600}"
                    HorizontalOptions="Start"
                    Command="{Binding GoBackCommand}"
                    Padding="12,8" />

            <!-- Header Card with Image and Info -->
            <Border StrokeShape="RoundRectangle 24"
                    Stroke="{StaticResource Gray200}"
                    BackgroundColor="{StaticResource White}"
                    Shadow="{StaticResource SmallShadow}">
                <Grid RowDefinitions="360,Auto">
                    <!-- Large Recipe Image -->
                    <Image Source="{Binding Recipe.Image}"
                           Aspect="AspectFill"
                           HeightRequest="360" />

                    <!-- Recipe Info Panel -->
                    <VerticalStackLayout Grid.Row="1" 
                                         Padding="32"
                                         Spacing="16">
                        <!-- Tags -->
                        <HorizontalStackLayout Spacing="8">
                            <Border BackgroundColor="{StaticResource Orange100}"
                                    StrokeShape="RoundRectangle 8"
                                    StrokeThickness="0"
                                    Padding="12,6">
                                <Label Text="{Binding CategoryLabel}"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource Orange700}" />
                            </Border>
                            <Border BackgroundColor="{StaticResource Gray100}"
                                    StrokeShape="RoundRectangle 8"
                                    StrokeThickness="0"
                                    Padding="12,6">
                                <Label Text="{Binding DifficultyLabel}"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource Gray700}" />
                            </Border>
                        </HorizontalStackLayout>

                        <!-- Title -->
                        <Label Text="{Binding Recipe.Title}"
                               Style="{StaticResource Title1}"
                               TextColor="{StaticResource Gray900}" />

                        <!-- Meta Info Grid -->
                        <Grid ColumnDefinitions="*,*,*" ColumnSpacing="16">
                            <!-- Time -->
                            <HorizontalStackLayout Spacing="12">
                                <Border BackgroundColor="{StaticResource Orange500}"
                                        StrokeShape="RoundRectangle 10"
                                        StrokeThickness="0"
                                        WidthRequest="40"
                                        HeightRequest="40"
                                        Shadow="{StaticResource SmallShadow}">
                                    <Label Text="â±ï¸"
                                           FontSize="18"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center" />
                                </Border>
                                <VerticalStackLayout VerticalOptions="Center">
                                    <Label Text="Zeit"
                                           FontSize="11"
                                           TextColor="{StaticResource Gray500}" />
                                    <HorizontalStackLayout Spacing="2">
                                        <Label Text="{Binding Recipe.TotalTime}"
                                               FontSize="14"
                                               FontAttributes="Bold" />
                                        <Label Text="Minuten"
                                               FontSize="10"
                                               TextColor="{StaticResource Gray500}"
                                               VerticalOptions="End"
                                               Margin="0,0,0,1" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>

                            <!-- Servings -->
                            <HorizontalStackLayout Grid.Column="1" Spacing="12">
                                <Border BackgroundColor="{StaticResource Blue500}"
                                        StrokeShape="RoundRectangle 10"
                                        StrokeThickness="0"
                                        WidthRequest="40"
                                        HeightRequest="40"
                                        Shadow="{StaticResource SmallShadow}">
                                    <Label Text="ðŸ‘¥"
                                           FontSize="18"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center" />
                                </Border>
                                <VerticalStackLayout VerticalOptions="Center">
                                    <Label Text="Portionen"
                                           FontSize="11"
                                           TextColor="{StaticResource Gray500}" />
                                    <HorizontalStackLayout Spacing="2">
                                        <Label Text="{Binding Recipe.Servings}"
                                               FontSize="14"
                                               FontAttributes="Bold" />
                                        <Label Text="Personen"
                                               FontSize="10"
                                               TextColor="{StaticResource Gray500}"
                                               VerticalOptions="End"
                                               Margin="0,0,0,1" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>

                            <!-- Difficulty -->
                            <HorizontalStackLayout Grid.Column="2" Spacing="12">
                                <Border BackgroundColor="{StaticResource Purple500}"
                                        StrokeShape="RoundRectangle 10"
                                        StrokeThickness="0"
                                        WidthRequest="40"
                                        HeightRequest="40"
                                        Shadow="{StaticResource SmallShadow}">
                                    <Label Text="ðŸ‘¨â€ðŸ³"
                                           FontSize="18"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center" />
                                </Border>
                                <VerticalStackLayout VerticalOptions="Center">
                                    <Label Text="Level"
                                           FontSize="11"
                                           TextColor="{StaticResource Gray500}" />
                                    <Label Text="{Binding DifficultyLabel}"
                                           FontSize="14"
                                           FontAttributes="Bold" />
                                </VerticalStackLayout>
                            </HorizontalStackLayout>
                        </Grid>

                        <!-- Recipe Tags -->
                        <HorizontalStackLayout Spacing="8"
                                               BindableLayout.ItemsSource="{Binding Recipe.Tags}">
                            <BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="x:String">
                                    <Border BackgroundColor="{StaticResource Gray100}"
                                            StrokeShape="RoundRectangle 16"
                                            StrokeThickness="0"
                                            Padding="12,6">
                                        <Label Text="{Binding StringFormat='#{0}'}"
                                               FontSize="12"
                                               TextColor="{StaticResource Gray600}" />
                                    </Border>
                                </DataTemplate>
                            </BindableLayout.ItemTemplate>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!-- Content Grid: Ingredients & Instructions -->
            <Grid ColumnDefinitions="*,2*" ColumnSpacing="24">
                
                <!-- Ingredients Card -->
                <Border StrokeShape="RoundRectangle 24"
                        Stroke="{StaticResource Gray200}"
                        BackgroundColor="{StaticResource White}"
                        Padding="24"
                        Shadow="{StaticResource SmallShadow}">
                    <VerticalStackLayout Spacing="16">
                        <!-- Header -->
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Text="Zutaten"
                                   Style="{StaticResource Title2}"
                                   TextColor="{StaticResource Gray900}" />
                            <Border Grid.Column="1"
                                    BackgroundColor="{StaticResource Green50}"
                                    StrokeShape="RoundRectangle 12"
                                    StrokeThickness="0"
                                    Padding="8,4">
                                <Label Text="{Binding Recipe.Ingredients.Count, StringFormat='{0} Zutaten'}"
                                       FontSize="11"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource Green600}" />
                            </Border>
                        </Grid>

                        <!-- Ingredients List -->
                        <CollectionView ItemsSource="{Binding Recipe.Ingredients}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="x:String">
                                    <HorizontalStackLayout Spacing="8" Padding="4,4">
                                        <Ellipse Fill="{StaticResource Orange400}"
                                                 WidthRequest="6"
                                                 HeightRequest="6"
                                                 VerticalOptions="Start"
                                                 Margin="0,6,0,0" />
                                        <Label Text="{Binding}"
                                               FontSize="14"
                                               TextColor="{StaticResource Gray800}"
                                               LineBreakMode="WordWrap" />
                                    </HorizontalStackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

                <!-- Instructions Card -->
                <Border Grid.Column="1"
                        StrokeShape="RoundRectangle 24"
                        Stroke="{StaticResource Gray200}"
                        BackgroundColor="{StaticResource White}"
                        Padding="24"
                        Shadow="{StaticResource SmallShadow}">
                    <VerticalStackLayout Spacing="16">
                        <Label Text="Zubereitung"
                               Style="{StaticResource Title2}"
                               TextColor="{StaticResource Gray900}" />

                        <!-- Instructions List -->
                        <CollectionView ItemsSource="{Binding Recipe.Instructions}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="x:String">
                                    <HorizontalStackLayout Spacing="12" Padding="0,8">
                                        <!-- Step Number Circle -->
                                        <Border BackgroundColor="{StaticResource Orange500}"
                                                StrokeShape="RoundRectangle 14"
                                                StrokeThickness="0"
                                                WidthRequest="28"
                                                HeightRequest="28"
                                                Shadow="{StaticResource SmallShadow}">
                                            <!-- Note: Index not directly available in MAUI, using placeholder -->
                                            <Label Text="â€¢"
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource White}"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center" />
                                        </Border>
                                        <Label Text="{Binding}"
                                               FontSize="14"
                                               TextColor="{StaticResource Gray800}"
                                               LineBreakMode="WordWrap"
                                               VerticalOptions="Center" />
                                    </HorizontalStackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                               IsVisible="{Binding IsLoading}"
                               Color="{StaticResource Orange500}"
                               HorizontalOptions="Center"
                               VerticalOptions="Center" />
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
