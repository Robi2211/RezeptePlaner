<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="RezeptePlaner.Maui.Controls.RecipeFilterBar"
             x:Name="FilterBarControl">
    
    <VerticalStackLayout Spacing="10">
        
        <!-- Filter Bar Card -->
        <Frame BackgroundColor="{StaticResource Surface}"
               BorderColor="{StaticResource Border}"
               CornerRadius="20"
               Padding="20"
               HasShadow="True">
            <Grid x:Name="FilterGrid">
                
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="LayoutStates">
                        <!-- Small screens: Stack all vertically -->
                        <VisualState x:Name="Small">
                            <VisualState.Setters>
                                <Setter TargetName="FilterGrid" Property="Grid.RowDefinitions" Value="Auto,Auto,Auto,Auto" />
                                <Setter TargetName="FilterGrid" Property="Grid.ColumnDefinitions" Value="*" />
                                <Setter TargetName="FilterGrid" Property="Grid.RowSpacing" Value="10" />
                                <Setter TargetName="FilterGrid" Property="Grid.ColumnSpacing" Value="0" />
                                
                                <Setter TargetName="SearchBorder" Property="Grid.Row" Value="0" />
                                <Setter TargetName="SearchBorder" Property="Grid.Column" Value="0" />
                                <Setter TargetName="SearchBorder" Property="Border.WidthRequest" Value="-1" />
                                
                                <Setter TargetName="CategoryBorder" Property="Grid.Row" Value="1" />
                                <Setter TargetName="CategoryBorder" Property="Grid.Column" Value="0" />
                                <Setter TargetName="CategoryBorder" Property="Border.WidthRequest" Value="-1" />
                                
                                <Setter TargetName="DifficultyBorder" Property="Grid.Row" Value="2" />
                                <Setter TargetName="DifficultyBorder" Property="Grid.Column" Value="0" />
                                <Setter TargetName="DifficultyBorder" Property="Border.WidthRequest" Value="-1" />
                                
                                <Setter TargetName="TimeBorder" Property="Grid.Row" Value="3" />
                                <Setter TargetName="TimeBorder" Property="Grid.Column" Value="0" />
                                <Setter TargetName="TimeBorder" Property="Border.WidthRequest" Value="-1" />
                            </VisualState.Setters>
                        </VisualState>
                        
                        <!-- Medium screens: Horizontal with wrapping -->
                        <VisualState x:Name="Medium">
                            <VisualState.Setters>
                                <Setter TargetName="FilterGrid" Property="Grid.RowDefinitions" Value="Auto,Auto,Auto" />
                                <Setter TargetName="FilterGrid" Property="Grid.ColumnDefinitions" Value="*,*" />
                                <Setter TargetName="FilterGrid" Property="Grid.RowSpacing" Value="10" />
                                <Setter TargetName="FilterGrid" Property="Grid.ColumnSpacing" Value="10" />
                                
                                <Setter TargetName="SearchBorder" Property="Grid.Row" Value="0" />
                                <Setter TargetName="SearchBorder" Property="Grid.Column" Value="0" />
                                <Setter TargetName="SearchBorder" Property="Grid.ColumnSpan" Value="2" />
                                <Setter TargetName="SearchBorder" Property="Border.WidthRequest" Value="-1" />
                                
                                <Setter TargetName="CategoryBorder" Property="Grid.Row" Value="1" />
                                <Setter TargetName="CategoryBorder" Property="Grid.Column" Value="0" />
                                <Setter TargetName="CategoryBorder" Property="Grid.ColumnSpan" Value="1" />
                                <Setter TargetName="CategoryBorder" Property="Border.WidthRequest" Value="-1" />
                                
                                <Setter TargetName="DifficultyBorder" Property="Grid.Row" Value="1" />
                                <Setter TargetName="DifficultyBorder" Property="Grid.Column" Value="1" />
                                <Setter TargetName="DifficultyBorder" Property="Grid.ColumnSpan" Value="1" />
                                <Setter TargetName="DifficultyBorder" Property="Border.WidthRequest" Value="-1" />
                                
                                <Setter TargetName="TimeBorder" Property="Grid.Row" Value="2" />
                                <Setter TargetName="TimeBorder" Property="Grid.Column" Value="0" />
                                <Setter TargetName="TimeBorder" Property="Grid.ColumnSpan" Value="2" />
                                <Setter TargetName="TimeBorder" Property="Border.WidthRequest" Value="-1" />
                            </VisualState.Setters>
                        </VisualState>
                        
                        <!-- Large screens: Full horizontal row -->
                        <VisualState x:Name="Large">
                            <VisualState.Setters>
                                <Setter TargetName="FilterGrid" Property="Grid.RowDefinitions" Value="Auto" />
                                <Setter TargetName="FilterGrid" Property="Grid.ColumnDefinitions" Value="*,Auto,Auto,Auto" />
                                <Setter TargetName="FilterGrid" Property="Grid.RowSpacing" Value="0" />
                                <Setter TargetName="FilterGrid" Property="Grid.ColumnSpacing" Value="10" />
                                
                                <Setter TargetName="SearchBorder" Property="Grid.Row" Value="0" />
                                <Setter TargetName="SearchBorder" Property="Grid.Column" Value="0" />
                                <Setter TargetName="SearchBorder" Property="Grid.ColumnSpan" Value="1" />
                                <Setter TargetName="SearchBorder" Property="Border.WidthRequest" Value="-1" />
                                
                                <Setter TargetName="CategoryBorder" Property="Grid.Row" Value="0" />
                                <Setter TargetName="CategoryBorder" Property="Grid.Column" Value="1" />
                                <Setter TargetName="CategoryBorder" Property="Grid.ColumnSpan" Value="1" />
                                <Setter TargetName="CategoryBorder" Property="Border.WidthRequest" Value="180" />
                                
                                <Setter TargetName="DifficultyBorder" Property="Grid.Row" Value="0" />
                                <Setter TargetName="DifficultyBorder" Property="Grid.Column" Value="2" />
                                <Setter TargetName="DifficultyBorder" Property="Grid.ColumnSpan" Value="1" />
                                <Setter TargetName="DifficultyBorder" Property="Border.WidthRequest" Value="200" />
                                
                                <Setter TargetName="TimeBorder" Property="Grid.Row" Value="0" />
                                <Setter TargetName="TimeBorder" Property="Grid.Column" Value="3" />
                                <Setter TargetName="TimeBorder" Property="Grid.ColumnSpan" Value="1" />
                                <Setter TargetName="TimeBorder" Property="Border.WidthRequest" Value="220" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
                
                <!-- Search Bar with Icon -->
                <Border x:Name="SearchBorder"
                        BackgroundColor="{StaticResource Gray100}"
                        Stroke="{StaticResource Border}"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 25"
                        Padding="0"
                        HeightRequest="45">
                    <Border.Shadow>
                        <Shadow Brush="{StaticResource Gray300}"
                                Offset="0,2"
                                Radius="5"
                                Opacity="0.2" />
                    </Border.Shadow>
                    <Grid ColumnDefinitions="Auto,*" Padding="15,12,20,12">
                        <!-- Search Icon -->
                        <Label Grid.Column="0"
                               Text="ðŸ”"
                               TextColor="{StaticResource Primary}"
                               FontSize="16"
                               VerticalOptions="Center"
                               Margin="0,0,8,0" />
                        <!-- Search Entry -->
                        <Entry Grid.Column="1"
                               Text="{Binding Source={x:Reference FilterBarControl}, Path=SearchText, Mode=TwoWay}"
                               Placeholder="Rezepte oder Zutaten suchen..."
                               PlaceholderColor="#333333"
                               TextColor="{StaticResource Black}"
                               BackgroundColor="Transparent"
                               FontSize="16"
                               HorizontalTextAlignment="Start"
                               VerticalOptions="Center" />
                    </Grid>
                </Border>
                
                <!-- Category Dropdown -->
                <Border x:Name="CategoryBorder"
                        BackgroundColor="{StaticResource Gray100}"
                        Stroke="{StaticResource Border}"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 25"
                        Padding="0"
                        HeightRequest="45">
                    <Border.Shadow>
                        <Shadow Brush="{StaticResource Gray300}"
                                Offset="0,2"
                                Radius="5"
                                Opacity="0.2" />
                    </Border.Shadow>
                    <Grid>
                        <!-- Invisible Picker for functionality -->
                        <Picker ItemsSource="{Binding Source={x:Reference FilterBarControl}, Path=Categories}"
                                SelectedItem="{Binding Source={x:Reference FilterBarControl}, Path=SelectedCategory, Mode=TwoWay}"
                                Title="Alle Kategorien"
                                Opacity="0"
                                BackgroundColor="Transparent" />
                        <!-- Visual layer with centered text -->
                        <Grid InputTransparent="True">
                            <Label Text="{Binding Source={x:Reference FilterBarControl}, Path=SelectedCategory, TargetNullValue='Alle Kategorien', FallbackValue='Alle Kategorien'}"
                                   TextColor="{StaticResource Foreground}"
                                   FontSize="16"
                                   HorizontalTextAlignment="Center"
                                   VerticalTextAlignment="Center"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center"
                                   LineBreakMode="TailTruncation"
                                   Margin="15,0,35,0" />
                            <Label Text="â–¼"
                                   TextColor="{StaticResource ForegroundMuted}"
                                   FontSize="12"
                                   VerticalOptions="Center"
                                   HorizontalOptions="End"
                                   Margin="0,0,15,0" />
                        </Grid>
                    </Grid>
                </Border>
                
                <!-- Difficulty Dropdown -->
                <Border x:Name="DifficultyBorder"
                        BackgroundColor="{StaticResource Gray100}"
                        Stroke="{StaticResource Border}"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 25"
                        Padding="0"
                        HeightRequest="45">
                    <Border.Shadow>
                        <Shadow Brush="{StaticResource Gray300}"
                                Offset="0,2"
                                Radius="5"
                                Opacity="0.2" />
                    </Border.Shadow>
                    <Grid>
                        <!-- Invisible Picker for functionality -->
                        <Picker ItemsSource="{Binding Source={x:Reference FilterBarControl}, Path=Difficulties}"
                                SelectedItem="{Binding Source={x:Reference FilterBarControl}, Path=SelectedDifficulty, Mode=TwoWay}"
                                Title="Alle Schwierigkeiten"
                                Opacity="0"
                                BackgroundColor="Transparent" />
                        <!-- Visual layer with centered text -->
                        <Grid InputTransparent="True">
                            <Label Text="{Binding Source={x:Reference FilterBarControl}, Path=SelectedDifficulty, TargetNullValue='Alle Schwierigkeiten', FallbackValue='Alle Schwierigkeiten'}"
                                   TextColor="{StaticResource Foreground}"
                                   FontSize="16"
                                   HorizontalTextAlignment="Center"
                                   VerticalTextAlignment="Center"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center"
                                   LineBreakMode="TailTruncation"
                                   Margin="15,0,35,0" />
                            <Label Text="â–¼"
                                   TextColor="{StaticResource ForegroundMuted}"
                                   FontSize="12"
                                   VerticalOptions="Center"
                                   HorizontalOptions="End"
                                   Margin="0,0,15,0" />
                        </Grid>
                    </Grid>
                </Border>
                
                <!-- Time Slider -->
                <Border x:Name="TimeBorder"
                        BackgroundColor="{StaticResource Gray100}"
                        Stroke="{StaticResource Border}"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 25"
                        Padding="15,10,15,10"
                        HeightRequest="45">
                    <Border.Shadow>
                        <Shadow Brush="{StaticResource Gray300}"
                                Offset="0,2"
                                Radius="5"
                                Opacity="0.2" />
                    </Border.Shadow>
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                        <!-- Clock Icon -->
                        <Label Grid.Column="0"
                               Text="ðŸ•"
                               TextColor="{StaticResource Primary}"
                               FontSize="16"
                               VerticalOptions="Center" />
                        <!-- Slider -->
                        <Slider Grid.Column="1"
                                Minimum="0"
                                Maximum="180"
                                Value="{Binding Source={x:Reference FilterBarControl}, Path=MaxTimeMinutes, Mode=TwoWay}"
                                MinimumTrackColor="{StaticResource Primary}"
                                MaximumTrackColor="{StaticResource Gray300}"
                                ThumbColor="{StaticResource Primary}"
                                VerticalOptions="Center"
                                Margin="0,0,5,0" />
                        <!-- Time Label -->
                        <Label Grid.Column="2"
                               Text="{Binding Source={x:Reference FilterBarControl}, Path=MaxTimeMinutes, StringFormat='{0}+ Min'}"
                               TextColor="{StaticResource Foreground}"
                               FontSize="12"
                               VerticalOptions="Center"
                               HorizontalTextAlignment="End"
                               LineBreakMode="NoWrap"
                               MinimumWidthRequest="80" />
                    </Grid>
                </Border>
                
            </Grid>
        </Frame>
        
        <!-- Result Count Label -->
        <Label Text="{Binding Source={x:Reference FilterBarControl}, Path=ResultCount, StringFormat='{0} Rezepte gefunden'}"
               TextColor="{StaticResource ForegroundMuted}"
               FontSize="14"
               Margin="5,0,0,0" />
        
    </VerticalStackLayout>
    
</ContentView>
