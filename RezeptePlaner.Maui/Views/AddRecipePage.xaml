<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:RezeptePlaner.Maui.ViewModels"
             xmlns:models="clr-namespace:RezeptePlaner.Maui.Models"
             xmlns:controls="clr-namespace:RezeptePlaner.Maui.Controls"
             x:Class="RezeptePlaner.Maui.Views.AddRecipePage"
             x:DataType="viewmodels:AddRecipeViewModel"
             Title="Neues Rezept"
             BackgroundColor="{StaticResource Background}">

    <Grid RowDefinitions="Auto,*">
        <!-- Navigation Header -->
        <controls:NavigationHeader Grid.Row="0" CurrentPage="" />

        <ScrollView Grid.Row="1">
            <Grid Padding="20" RowDefinitions="Auto,*">
            
            <!-- Page Header -->
            <VerticalStackLayout Grid.Row="0" Margin="0,0,0,20">
                <Label Text="ðŸ“ Neues Rezept erstellen" 
                       Style="{StaticResource PageTitle}" />
                <Label Text="FÃ¼llen Sie alle Pflichtfelder aus (*)"
                       TextColor="{StaticResource ForegroundMuted}"
                       FontSize="14" />
            </VerticalStackLayout>

            <!-- Form Content with Two-Column Layout -->
            <Grid Grid.Row="1" ColumnDefinitions="*,*" ColumnSpacing="24" IsVisible="{Binding ShowSuccessMessage, Converter={StaticResource InvertedBoolConverter}}">
                
                <!-- Left Column -->
                <VerticalStackLayout Grid.Column="0" Spacing="20">
                
                    <!-- Basic Information Card -->
                    <Frame Style="{StaticResource CardFrame}">
                        <VerticalStackLayout Spacing="15">
                            <Label Text="Grundinformationen" 
                                   Style="{StaticResource SectionTitle}" />
                            
                            <!-- Recipe Title (Entry) -->
                            <VerticalStackLayout>
                                <Label Text="Rezeptname *" 
                                       TextColor="{StaticResource Foreground}"
                                       FontSize="14"
                                       Margin="0,0,0,5" />
                                <Border BackgroundColor="{StaticResource Muted}"
                                        Stroke="{StaticResource Border}"
                                        StrokeShape="RoundRectangle 8"
                                        Padding="12,8">
                                    <Entry Text="{Binding Title}"
                                           Placeholder="z.B. Spaghetti Carbonara"
                                           PlaceholderColor="{StaticResource ForegroundMuted}"
                                           TextColor="{StaticResource Foreground}"
                                           BackgroundColor="Transparent"
                                           FontSize="14" />
                                </Border>
                                <Label Text="{Binding TitleError}"
                                       Style="{StaticResource ErrorText}"
                                       IsVisible="{Binding TitleError, Converter={StaticResource StringToBoolConverter}}" />
                            </VerticalStackLayout>

                            <!-- Category and Difficulty in Grid -->
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                                <!-- Category Picker -->
                                <VerticalStackLayout Grid.Column="0">
                                    <Label Text="Kategorie" 
                                           TextColor="{StaticResource Foreground}"
                                           FontSize="14"
                                           Margin="0,0,0,5" />
                                    <Border BackgroundColor="{StaticResource Muted}"
                                            Stroke="{StaticResource Border}"
                                            StrokeShape="RoundRectangle 8"
                                            Padding="12,8">
                                        <Picker ItemsSource="{Binding Categories}"
                                                SelectedItem="{Binding SelectedCategory}"
                                                TextColor="{StaticResource Foreground}"
                                                TitleColor="{StaticResource ForegroundMuted}"
                                                BackgroundColor="Transparent" />
                                    </Border>
                                </VerticalStackLayout>

                                <!-- Difficulty Picker -->
                                <VerticalStackLayout Grid.Column="1">
                                    <Label Text="Schwierigkeit" 
                                           TextColor="{StaticResource Foreground}"
                                           FontSize="14"
                                           Margin="0,0,0,5" />
                                    <Border BackgroundColor="{StaticResource Muted}"
                                            Stroke="{StaticResource Border}"
                                            StrokeShape="RoundRectangle 8"
                                            Padding="12,8">
                                        <Picker ItemsSource="{Binding DifficultyLevels}"
                                                SelectedItem="{Binding SelectedDifficulty}"
                                                TextColor="{StaticResource Foreground}"
                                                TitleColor="{StaticResource ForegroundMuted}"
                                                BackgroundColor="Transparent" />
                                    </Border>
                                </VerticalStackLayout>
                            </Grid>

                            <!-- Prep Time and Cook Time in Grid -->
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                                <!-- Prep Time -->
                                <VerticalStackLayout Grid.Column="0">
                                    <Label Text="Vorbereitung (Min)" 
                                           TextColor="{StaticResource Foreground}"
                                           FontSize="14"
                                           Margin="0,0,0,5" />
                                    <Border BackgroundColor="{StaticResource Muted}"
                                            Stroke="{StaticResource Border}"
                                            StrokeShape="RoundRectangle 8"
                                            Padding="12,8">
                                        <Entry Text="{Binding PrepTime}"
                                               Keyboard="Numeric"
                                               TextColor="{StaticResource Foreground}"
                                               BackgroundColor="Transparent"
                                               FontSize="14" />
                                    </Border>
                                </VerticalStackLayout>

                                <!-- Cook Time -->
                                <VerticalStackLayout Grid.Column="1">
                                    <Label Text="Kochzeit (Min)" 
                                           TextColor="{StaticResource Foreground}"
                                           FontSize="14"
                                           Margin="0,0,0,5" />
                                    <Border BackgroundColor="{StaticResource Muted}"
                                            Stroke="{StaticResource Border}"
                                            StrokeShape="RoundRectangle 8"
                                            Padding="12,8">
                                        <Entry Text="{Binding CookTime}"
                                               Keyboard="Numeric"
                                               TextColor="{StaticResource Foreground}"
                                               BackgroundColor="Transparent"
                                               FontSize="14" />
                                    </Border>
                                </VerticalStackLayout>
                            </Grid>

                            <!-- Servings -->
                            <VerticalStackLayout>
                                <Label Text="Portionen" 
                                       TextColor="{StaticResource Foreground}"
                                       FontSize="14"
                                       Margin="0,0,0,5" />
                                <Border BackgroundColor="{StaticResource Muted}"
                                        Stroke="{StaticResource Border}"
                                        StrokeShape="RoundRectangle 8"
                                        Padding="12,8">
                                    <Entry Text="{Binding Servings}"
                                           Keyboard="Numeric"
                                           TextColor="{StaticResource Foreground}"
                                           BackgroundColor="Transparent"
                                           FontSize="14" />
                                </Border>
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                        </Frame>

                    <!-- Ingredients Card -->
                <Frame Style="{StaticResource CardFrame}">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Zutaten *" 
                               Style="{StaticResource SectionTitle}" />
                        <Label Text="Eine Zutat pro Zeile eingeben"
                               TextColor="{StaticResource ForegroundMuted}"
                               FontSize="12" />
                        <Border BackgroundColor="{StaticResource Muted}"
                                Stroke="{StaticResource Border}"
                                StrokeShape="RoundRectangle 8"
                                Padding="12">
                            <Editor Text="{Binding IngredientsText}"
                                    Placeholder="z.B.&#x0a;400g Spaghetti&#x0a;200g Guanciale&#x0a;4 Eigelb"
                                    PlaceholderColor="{StaticResource ForegroundMuted}"
                                    TextColor="{StaticResource Foreground}"
                                    BackgroundColor="Transparent"
                                    HeightRequest="150"
                                    FontSize="14" />
                        </Border>
                        <Label Text="{Binding IngredientsError}"
                               Style="{StaticResource ErrorText}"
                               IsVisible="{Binding IngredientsError, Converter={StaticResource StringToBoolConverter}}" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Instructions Card -->
                <Frame Style="{StaticResource CardFrame}">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Zubereitung *" 
                               Style="{StaticResource SectionTitle}" />
                        <Label Text="Ein Schritt pro Zeile eingeben"
                               TextColor="{StaticResource ForegroundMuted}"
                               FontSize="12" />
                        <Border BackgroundColor="{StaticResource Muted}"
                                Stroke="{StaticResource Border}"
                                StrokeShape="RoundRectangle 8"
                                Padding="12">
                            <Editor Text="{Binding InstructionsText}"
                                    Placeholder="z.B.&#x0a;Wasser zum Kochen bringen&#x0a;Spaghetti al dente kochen&#x0a;Guanciale anbraten"
                                    PlaceholderColor="{StaticResource ForegroundMuted}"
                                    TextColor="{StaticResource Foreground}"
                                    BackgroundColor="Transparent"
                                    HeightRequest="150"
                                    FontSize="14" />
                        </Border>
                        <Label Text="{Binding InstructionsError}"
                               Style="{StaticResource ErrorText}"
                               IsVisible="{Binding InstructionsError, Converter={StaticResource StringToBoolConverter}}" />
                    </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>

                <!-- Right Column -->
                <VerticalStackLayout Grid.Column="1" Spacing="20">
                    
                    <!-- Recipe Image Card -->
                    <Frame Style="{StaticResource CardFrame}">
                        <VerticalStackLayout Spacing="15">
                            <Label Text="Rezeptbild" 
                                   Style="{StaticResource SectionTitle}" />
                            
                            <!-- Image Placeholder -->
                            <Border BackgroundColor="{StaticResource Muted}"
                                    Stroke="{StaticResource Border}"
                                    StrokeShape="RoundRectangle 8"
                                    StrokeThickness="2"
                                    StrokeDashArray="5,5"
                                    Padding="40"
                                    HeightRequest="200">
                                <VerticalStackLayout Spacing="10" HorizontalOptions="Center" VerticalOptions="Center">
                                    <Label Text="ðŸ–¼ï¸"
                                           FontSize="48"
                                           HorizontalOptions="Center" />
                                    <Label Text="Bild-URL hinzufÃ¼gen"
                                           TextColor="{StaticResource ForegroundMuted}"
                                           FontSize="14"
                                           HorizontalOptions="Center" />
                                </VerticalStackLayout>
                            </Border>
                            
                            <!-- Image URL Input -->
                            <Border BackgroundColor="{StaticResource Muted}"
                                    Stroke="{StaticResource Border}"
                                    StrokeShape="RoundRectangle 8"
                                    Padding="12,8">
                                <Entry Text="{Binding ImageUrl}"
                                       Placeholder="https://..."
                                       PlaceholderColor="{StaticResource ForegroundMuted}"
                                       TextColor="{StaticResource Foreground}"
                                       BackgroundColor="Transparent"
                                       FontSize="14" />
                            </Border>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Tags Card -->
                    <Frame Style="{StaticResource CardFrame}">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Tags" 
                                   Style="{StaticResource SectionTitle}" />
                            
                            <!-- Tags Input with Add Button -->
                            <HorizontalStackLayout Spacing="10">
                                <Border BackgroundColor="{StaticResource Muted}"
                                        Stroke="{StaticResource Border}"
                                        StrokeShape="RoundRectangle 8"
                                        Padding="12,8"
                                        HorizontalOptions="FillAndExpand">
                                    <Entry Text="{Binding TagsText}"
                                           Placeholder="Tag eingeben..."
                                           PlaceholderColor="{StaticResource ForegroundMuted}"
                                           TextColor="{StaticResource Foreground}"
                                           BackgroundColor="Transparent"
                                           FontSize="14"
                                           HorizontalOptions="FillAndExpand" />
                                </Border>
                                <Border BackgroundColor="{StaticResource Primary}"
                                        StrokeShape="RoundRectangle 8"
                                        Stroke="Transparent"
                                        WidthRequest="48"
                                        HeightRequest="48"
                                        Padding="0">
                                    <Label Text="+"
                                           TextColor="{StaticResource White}"
                                           FontSize="24"
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center" />
                                </Border>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Action Buttons -->
                    <VerticalStackLayout Spacing="15">
                        <Button Text="Rezept speichern"
                                Command="{Binding SaveRecipeCommand}"
                                Style="{StaticResource PrimaryButton}"
                                HeightRequest="56" />
                        <Button Text="Abbrechen"
                                Command="{Binding ResetFormCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource ForegroundMuted}"
                                BorderColor="Transparent"
                                FontSize="14" />
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Grid>

            <!-- Success Message -->
            <Frame Grid.Row="1"
                   Style="{StaticResource CardFrame}"
                   IsVisible="{Binding ShowSuccessMessage}"
                   VerticalOptions="Center">
                <VerticalStackLayout Spacing="20" HorizontalOptions="Center">
                    <Label Text="âœ…"
                           FontSize="80"
                           HorizontalOptions="Center" />
                    <Label Text="Rezept erfolgreich gespeichert!"
                           TextColor="{StaticResource Success}"
                           FontSize="24"
                           FontAttributes="Bold"
                           HorizontalOptions="Center" />
                    <Label Text="{Binding LastAddedRecipe.Title, StringFormat='&quot;{0}&quot; wurde zur Sammlung hinzugefÃ¼gt.'}"
                           TextColor="{StaticResource ForegroundMuted}"
                           FontSize="16"
                           HorizontalOptions="Center" />
                    
                    <HorizontalStackLayout Spacing="15" HorizontalOptions="Center" Margin="0,20,0,0">
                        <Button Text="Zusammenfassung anzeigen"
                                Command="{Binding ViewSummaryCommand}"
                                Style="{StaticResource PrimaryButton}" />
                        <Button Text="Weiteres Rezept hinzufÃ¼gen"
                                Command="{Binding AddAnotherCommand}"
                                Style="{StaticResource SecondaryButton}" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </ScrollView>
    </Grid>
</ContentPage>
